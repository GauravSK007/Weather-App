<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
      };
    </script>
    <title>Document</title>

    <style>
      * {
        margin: 0;
        padding: 0;
        font-family: "Poppins", sans-serif;
      }
    </style>
  </head>
  <body class="">
    <nav
      class="h-[80px] w-full bg-blue-500 dark:bg-gray-900 text-white flex items-center justify-between transition-colors duration-300">
      <h1
        class="text-[32px] mx-[20px] font-bold hover:[text-shadow:0px_0px_8px_rgba(255,255,255,0.5)] dark:text-gray-100">
        MyWeather
      </h1>
      <form action="">
        <input
          type="text"
          placeholder="Location..."
          class="h-[40px] w-[280px] px-4 text-gray-500 dark:text-gray-700 rounded-md border border-gray-300 dark:border-gray-700 shadow-sm placeholder:text-gray-500 dark:placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-700" />

        <button
          class="mx-[10px] h-[38px] px-[5px] bg-white dark:bg-gray-800 rounded-md text-blue-500 dark:text-blue-300 hover:bg-blue-700 dark:hover:bg-gray-700 hover:text-white dark:hover:text-blue-200 transition-colors duration-300">
          Search
        </button>
      </form>
      <div
        class="mx-[20px] h-[50px] w-[50px] bg-white dark:bg-gray-800 rounded-full flex items-center justify-center transition-colors duration-300">
        <button id="theme" class="text-[32px] dark:text-yellow-300">ğŸŒ™</button>
      </div>
    </nav>

    <main>
      <div
        class="mx-auto mt-10 bg-gradient-to-br from-blue-400 via-blue-200 to-white dark:from-gray-800 dark:via-gray-700 dark:to-gray-900 shadow-2xl rounded-3xl border-none p-8 flex flex-col items-center gap-6 w-full max-w-md transition-colors duration-300">
        <div id="code" class="text-[120px] drop-shadow-lg">ğŸŒ¤ï¸</div>
        <h1
          id="city"
          class="text-[40px] font-extrabold text-gray-800 dark:text-gray-100 tracking-wide mb-2">
          Delhi
        </h1>
        <p
          id="temperature"
          class="text-[32px] font-semibold text-blue-600 dark:text-blue-300 mb-1">
          29Â°C
        </p>
        <p
          id="min-max"
          class="text-[18px] text-gray-600 dark:text-gray-300 mb-2">
          <span class="font-medium">Min:</span> 19Â°C &nbsp;&nbsp;
          <span class="font-medium">Max:</span> 29Â°C
        </p>
        <p
          id="rain"
          class="text-[16px] text-blue-700 dark:text-blue-200 bg-blue-100 dark:bg-blue-900 rounded-lg px-4 py-2 shadow-sm">
          There's an 80% chance of rainâ€”better carry an umbrella!
        </p>
      </div>
    </main>

    <script>
      // Theme toggle functionality
      const themeButton = document.getElementById("theme");
      const html = document.documentElement;
      themeButton.addEventListener("click", () => {
        html.classList.toggle("dark");
        if (html.classList.contains("dark")) {
          themeButton.textContent = "â˜€ï¸"; // Change to sun icon
        } else {
          themeButton.textContent = "ğŸŒ™"; // Change to moon icon
        }
      });

      async function getweatherdata() {
        let locationResponse;
        let weatherResponse;
        let weatherdata;
        let locationData;
        let latitude;
        let longitude;

        //fetching loction through IP
        locationResponse = await fetch("https://ipinfo.io/json");
        locationData = await locationResponse.json();

        //city
        let city = locationData.city;
        let region = locationData.region;

        //extract coordinates
        latitude = locationData.loc.split(",")[0];
        longitude = locationData.loc.split(",")[1];

        //fetching weather data
        weatherResponse = await fetch(
          `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max&timezone=auto`
        );
        weatherdata = await weatherResponse.json();

        //imp data
        let weather = weatherdata.current_weather;
        let weekWeather = weatherdata.daily;

        let temperature = weather.temperature;
        let windspeed = weather.windspeed;
        let isday = weather.is_day;
        let weathercode = weather.weathercode;

        let dates = weekWeather.time;
        let maxTemp = weekWeather.temperature_2m_max;
        let minTemp = weekWeather.temperature_2m_min;
        let rain = weekWeather.precipitation_probability_max;

        //displaying data
        document.getElementById("city").innerText =
          city == region ? city : `${city}, ${region}`;
        document.getElementById("temperature").innerText = temperature + "Â°C";
        document.getElementById(
          "min-max"
        ).innerHTML = `<span class="font-medium">Min:</span> ${minTemp[0]}Â°C &nbsp;&nbsp; <span class="font-medium">Max:</span> ${maxTemp[0]}Â°C`;
        document.getElementById("rain").innerText =
          rain[0] > 50
            ? `There's an ${rain[0]}% chance of rainâ€”better carry an umbrella!`
            : `There's an ${rain[0]}% chance of rain.`;

        //displaying emoji for codes
        function getWeatherEmoji(code, isDay) {
          const emojiMap = {
            0: isDay === 1 ? "â˜€ï¸" : "ğŸŒ™",
            1: isDay === 1 ? "ğŸŒ¤ï¸" : "ğŸŒ™â˜ï¸",
            2: isDay === 1 ? "â›…" : "â˜ï¸ğŸŒ™",
            3: "â˜ï¸",
            45: "ğŸŒ«ï¸",
            48: "ğŸŒ«ï¸",
            51: isDay === 1 ? "ğŸŒ¦ï¸" : "ğŸŒ§ï¸",
            53: isDay === 1 ? "ğŸŒ¦ï¸" : "ğŸŒ§ï¸",
            55: isDay === 1 ? "ğŸŒ¦ï¸" : "ğŸŒ§ï¸",
            56: "ğŸ§ŠğŸŒ§ï¸",
            57: "ğŸ§ŠğŸŒ§ï¸",
            61: "ğŸŒ§ï¸",
            63: "ğŸŒ§ï¸",
            65: "ğŸŒ§ï¸",
            66: "ğŸ§ŠğŸŒ§ï¸",
            67: "ğŸ§ŠğŸŒ§ï¸",
            71: "â„ï¸",
            73: "â„ï¸",
            75: "â„ï¸",
            77: "ğŸŒ¨ï¸",
            80: isDay === 1 ? "ğŸŒ¦ï¸" : "ğŸŒ§ï¸",
            81: isDay === 1 ? "ğŸŒ¦ï¸" : "ğŸŒ§ï¸",
            82: isDay === 1 ? "ğŸŒ¦ï¸" : "ğŸŒ§ï¸",
            85: "ğŸŒ¨ï¸",
            86: "ğŸŒ¨ï¸",
            95: "â›ˆï¸",
            96: "â›ˆï¸ğŸ§Š",
            99: "â›ˆï¸ğŸ§Š",
          };

          return emojiMap[code] || "â“";
        }

        let emojiC = getWeatherEmoji(weathercode, isday)
        document.getElementById('code').innerText = emojiC;


      }

      //calling main async function
      getweatherdata();
    </script>
  </body>
</html>
